<svg xmlns="http://www.w3.org/2000/svg" width="1164" height="634" preserveAspectRatio="none" style="width:1164px;height:634px;background:#fff"><text x="499.25" y="27.995" font-family="sans-serif" font-size="14" font-weight="bold" textLength="168">数字证书申请与客户端验证</text><path d="M40 73.594v525.234M227.5 73.594v525.234M433 73.594v525.234M802 73.594v525.234" style="stroke:#181818;stroke-width:.5;stroke-dasharray:5,5"/><rect width="71" height="30.297" x="5" y="42.297" fill="#E2E2F0" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:.5"/><text x="12" y="62.292" font-family="sans-serif" font-size="14" textLength="57">Browser</text><rect width="71" height="30.297" x="5" y="597.828" fill="#E2E2F0" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:.5"/><text x="12" y="617.823" font-family="sans-serif" font-size="14" textLength="57">Browser</text><rect width="58" height="30.297" x="198.5" y="42.297" fill="#E2E2F0" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:.5"/><text x="205.5" y="62.292" font-family="sans-serif" font-size="14" textLength="44">Server</text><rect width="58" height="30.297" x="198.5" y="597.828" fill="#E2E2F0" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:.5"/><text x="205.5" y="617.823" font-family="sans-serif" font-size="14" textLength="44">Server</text><rect width="117" height="30.297" x="375" y="42.297" fill="#E2E2F0" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:.5"/><text x="382" y="62.292" font-family="sans-serif" font-size="14" textLength="103">证书颁发机构CA</text><rect width="117" height="30.297" x="375" y="597.828" fill="#E2E2F0" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:.5"/><text x="382" y="617.823" font-family="sans-serif" font-size="14" textLength="103">证书颁发机构CA</text><rect width="145" height="30.297" x="730" y="42.297" fill="#E2E2F0" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:.5"/><text x="737" y="62.292" font-family="sans-serif" font-size="14" textLength="131">证书注册审批机构RA</text><rect width="145" height="30.297" x="730" y="597.828" fill="#E2E2F0" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:.5"/><text x="737" y="617.823" font-family="sans-serif" font-size="14" textLength="131">证书注册审批机构RA</text><path d="M227.5 104.727h42M269.5 104.727v13M228.5 117.727h41" style="stroke:#181818;stroke-width:1"/><path fill="#181818" d="m238.5 113.727-10 4 10 4-4-4z" style="stroke:#181818;stroke-width:1"/><text x="234.5" y="99.661" font-family="sans-serif" font-size="13" textLength="65">生成密钥对</text><path d="M227.5 168.387h42M269.5 168.387v13M228.5 181.387h41" style="stroke:#181818;stroke-width:1"/><path fill="#181818" d="m238.5 177.387-10 4 10 4-4-4z" style="stroke:#181818;stroke-width:1"/><text x="234.5" y="163.321" font-family="sans-serif" font-size="13" textLength="192">使用私钥生成证书签名请求(CSR)</text><path fill="#FEFFDD" d="M438 130.727v75h175v-65l-10-10H438" style="stroke:#181818;stroke-width:.5"/><path fill="#FEFFDD" d="M603 130.727v10h10l-10-10" style="stroke:#181818;stroke-width:.5"/><text x="444" y="151.506" font-family="sans-serif" font-size="17" font-weight="bold" textLength="37">CSR</text><circle cx="449.5" cy="163.148" r="2.5" style="stroke:#000;stroke-width:0"/><text x="456" y="167.583" font-family="sans-serif" font-size="13" textLength="142">主体信息: 域名,国家等等</text><circle cx="449.5" cy="178.281" r="2.5" style="stroke:#000;stroke-width:0"/><text x="456" y="182.715" font-family="sans-serif" font-size="13" textLength="78">服务端的公钥</text><circle cx="449.5" cy="193.414" r="2.5" style="stroke:#000;stroke-width:0"/><text x="456" y="197.848" font-family="sans-serif" font-size="13" textLength="85">CSR签名算法?</text><path fill="#181818" d="m790.5 228.047 10 4-10 4 4-4z" style="stroke:#181818;stroke-width:1"/><path d="M227.5 232.047h569" style="stroke:#181818;stroke-width:1"/><text x="234.5" y="226.981" font-family="sans-serif" font-size="13" textLength="52">提交CSR</text><path d="M802.5 261.18h42M844.5 261.18v13M803.5 274.18h41" style="stroke:#181818;stroke-width:1"/><path fill="#181818" d="m813.5 270.18-10 4 10 4-4-4z" style="stroke:#181818;stroke-width:1"/><text x="809.5" y="256.114" font-family="sans-serif" font-size="13" textLength="104">验证CSR主体信息</text><path fill="#FEFFDD" d="M925 248.547v25h232v-15l-10-10H925" style="stroke:#181818;stroke-width:.5"/><path fill="#FEFFDD" d="M1147 248.547v10h10l-10-10" style="stroke:#181818;stroke-width:.5"/><text x="931" y="265.614" font-family="sans-serif" font-size="13" textLength="211">协助CA对CSR进行验证,ok后发给CA</text><path d="M433.5 362.672h42M475.5 362.672v13M434.5 375.672h41" style="stroke:#181818;stroke-width:1"/><path fill="#181818" d="m444.5 371.672-10 4 10 4-4-4z" style="stroke:#181818;stroke-width:1"/><text x="440.5" y="327.34" font-family="sans-serif" font-size="13" textLength="187">对CSR先hash算法得到一个摘要</text><text x="440.5" y="342.473" font-family="sans-serif" font-size="13" textLength="286">然后对这个摘要用自己私钥进行加密得到数字签名</text><text x="440.5" y="357.606" fill="red" font-family="sans-serif" font-size="13" textLength="355">最后把CSR中的身份信息,明文公钥和这个签名等作为数字证书</text><path fill="#FEFFDD" d="M165 287.18v120h263v-110l-10-10H165" style="stroke:#181818;stroke-width:.5"/><path fill="#FEFFDD" d="M418 287.18v10h10l-10-10" style="stroke:#181818;stroke-width:.5"/><text x="171" y="307.959" font-family="sans-serif" font-size="17" font-weight="bold" textLength="68">数字证书</text><circle cx="176.5" cy="319.602" r="2.5" style="stroke:#000;stroke-width:0"/><text x="183" y="324.036" font-family="sans-serif" font-size="13" textLength="170">服务端的公钥(特别说明:明文)</text><circle cx="176.5" cy="334.734" r="2.5" style="stroke:#000;stroke-width:0"/><text x="183" y="339.168" font-family="sans-serif" font-size="13" textLength="65">服务端信息</text><circle cx="176.5" cy="349.867" r="2.5" style="stroke:#000;stroke-width:0"/><text x="183" y="354.301" font-family="sans-serif" font-size="13" textLength="145">证书认证机构(CA)的信息</text><circle cx="176.5" cy="365" r="2.5" style="stroke:#000;stroke-width:0"/><text x="183" y="369.434" font-family="sans-serif" font-size="13" textLength="230">CA 对这份文件的数字签名及使用的算法</text><circle cx="176.5" cy="380.133" r="2.5" style="stroke:#000;stroke-width:0"/><text x="183" y="384.567" font-family="sans-serif" font-size="13" textLength="65">证书有效期</text><text x="171" y="399.7" font-family="sans-serif" font-size="13" textLength="4"> </text><path fill="#181818" d="m238.5 429.898-10 4 10 4-4-4z" style="stroke:#181818;stroke-width:1"/><path d="M232.5 433.898h200" style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2"/><text x="244.5" y="428.832" font-family="sans-serif" font-size="13" textLength="91">返回签发的证书</text><path fill="#181818" d="m51.5 459.031-10 4 10 4-4-4z" style="stroke:#181818;stroke-width:1"/><path d="M45.5 463.031h181" style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2"/><text x="57.5" y="457.965" font-family="sans-serif" font-size="13" textLength="104">传输证书给浏览器</text><path d="M40.5 567.828h42M82.5 567.828v13M41.5 580.828h41" style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2"/><path fill="#181818" d="m51.5 576.828-10 4 10 4-4-4z" style="stroke:#181818;stroke-width:1"/><text x="47.5" y="487.098" font-family="sans-serif" font-size="13" textLength="152">从系统找到对应的CA公钥,</text><text x="47.5" y="502.231" font-family="sans-serif" font-size="13" textLength="173">对证书里的数字签名进行解密,</text><text x="47.5" y="517.364" font-family="sans-serif" font-size="13" textLength="148">得到公钥等信息的hash值</text><text x="47.5" y="532.497" font-family="sans-serif" font-size="13" textLength="161">对公钥等信息进行hash运算</text><text x="47.5" y="547.629" font-family="sans-serif" font-size="13" textLength="165">结果和解密得到的hash比较,</text><text x="47.5" y="562.762" font-family="sans-serif" font-size="13" textLength="171">如果一致且域名无误就表示ok</text><path fill="#FEFFDD" d="M232 479.531v100h367v-90l-10-10H232" style="stroke:#181818;stroke-width:.5"/><path fill="#FEFFDD" d="M589 479.531v10h10l-10-10" style="stroke:#181818;stroke-width:.5"/><text x="238" y="496.598" font-family="sans-serif" font-size="13" textLength="293">1. 如果在服务端和浏览器交换公钥的过程中被篡改,</text><text x="238" y="511.731" font-family="sans-serif" font-size="13" textLength="278">由于中间人不知道CA私钥,hash值无法重新生成,</text><text x="238" y="526.864" font-family="sans-serif" font-size="13" textLength="294">从这点上看,数字签名可以理解为具有防篡改的能力.</text><text x="238" y="541.997" font-family="sans-serif" font-size="13" textLength="346">2. 如果hash值正确,前面提到过可能是中间人自己向CA申请,</text><text x="238" y="557.129" fill="red" font-family="sans-serif" font-size="13" textLength="273">这个最终会还是得看域名与自己请求的是否匹配</text><text x="511" y="557.129" font-family="sans-serif" font-size="13" textLength="4">,</text><text x="238" y="572.262" font-family="sans-serif" font-size="13" textLength="277">那么从这点上看,数字签名仅仅是验证数据完整性</text></svg>